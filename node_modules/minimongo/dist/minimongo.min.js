require=function t(n,e,r){function o(u,c){if(!e[u]){if(!n[u]){var s="function"==typeof require&&require;if(!c&&s)return s(u,!0);if(i)return i(u,!0);throw new Error("Cannot find module '"+u+"'")}var a=e[u]={exports:{}};n[u][0].call(a.exports,function(t){var e=n[u][1][t];return o(e?e:t)},a,a.exports,t,n,e,r)}return e[u].exports}for(var i="function"==typeof require&&require,u=0;u<r.length;u++)o(r[u]);return o}({minimongo:[function(t,n){n.exports=t("1+WUYb")},{}],"1+WUYb":[function(t,n,e){e.MemoryDb=t("./lib/MemoryDb"),e.LocalStorageDb=t("./lib/LocalStorageDb"),e.IndexedDb=t("./lib/IndexedDb"),e.WebSQLDb=t("./lib/WebSQLDb"),e.RemoteDb=t("./lib/RemoteDb"),e.HybridDb=t("./lib/HybridDb"),e.utils=t("./lib/utils")},{"./lib/HybridDb":6,"./lib/IndexedDb":7,"./lib/LocalStorageDb":8,"./lib/MemoryDb":9,"./lib/RemoteDb":10,"./lib/WebSQLDb":11,"./lib/utils":13}],dsrzUy:[function(t,n){n.exports=window.$},{}],jquery:[function(t,n){n.exports=t("dsrzUy")},{}],5:[function(t,n){var e=t("lodash");EJSON={};var r={};EJSON.addType=function(t,n){if(e.has(r,t))throw new Error("Type "+t+" already present");r[t]=n};var o=[{matchJSONValue:function(t){return e.has(t,"$date")&&1===e.size(t)},matchObject:function(t){return t instanceof Date},toJSONValue:function(t){return{$date:t.getTime()}},fromJSONValue:function(t){return new Date(t.$date)}},{matchJSONValue:function(t){return e.has(t,"$binary")&&1===e.size(t)},matchObject:function(t){return"undefined"!=typeof Uint8Array&&t instanceof Uint8Array||t&&e.has(t,"$Uint8ArrayPolyfill")},toJSONValue:function(t){return{$binary:EJSON._base64Encode(t)}},fromJSONValue:function(t){return EJSON._base64Decode(t.$binary)}},{matchJSONValue:function(t){return e.has(t,"$escape")&&1===e.size(t)},matchObject:function(t){return e.isEmpty(t)||e.size(t)>2?!1:e.any(o,function(n){return n.matchJSONValue(t)})},toJSONValue:function(t){var n={};return e.each(t,function(t,e){n[e]=EJSON.toJSONValue(t)}),{$escape:n}},fromJSONValue:function(t){var n={};return e.each(t.$escape,function(t,e){n[e]=EJSON.fromJSONValue(t)}),n}},{matchJSONValue:function(t){return e.has(t,"$type")&&e.has(t,"$value")&&2===e.size(t)},matchObject:function(t){return EJSON._isCustomType(t)},toJSONValue:function(t){return{$type:t.typeName(),$value:t.toJSONValue()}},fromJSONValue:function(t){var n=t.$type,e=r[n];return e(t.$value)}}];EJSON._isCustomType=function(t){return t&&"function"==typeof t.toJSONValue&&"function"==typeof t.typeName&&e.has(r,t.typeName())};var i=EJSON._adjustTypesToJSONValue=function(t){if(null===t)return null;var n=u(t);return void 0!==n?n:(e.each(t,function(n,e){if("object"==typeof n||void 0===n){var r=u(n);return r?void(t[e]=r):void i(n)}}),t)},u=function(t){for(var n=0;n<o.length;n++){var e=o[n];if(e.matchObject(t))return e.toJSONValue(t)}return void 0};EJSON.toJSONValue=function(t){var n=u(t);return void 0!==n?n:("object"==typeof t&&(t=EJSON.clone(t),i(t)),t)};var c=EJSON._adjustTypesFromJSONValue=function(t){if(null===t)return null;var n=s(t);return n!==t?n:(e.each(t,function(n,e){if("object"==typeof n){var r=s(n);if(n!==r)return void(t[e]=r);c(n)}}),t)},s=function(t){if("object"==typeof t&&null!==t&&e.size(t)<=2&&e.all(t,function(t,n){return"string"==typeof n&&"$"===n.substr(0,1)}))for(var n=0;n<o.length;n++){var r=o[n];if(r.matchJSONValue(t))return r.fromJSONValue(t)}return t};EJSON.fromJSONValue=function(t){var n=s(t);return n===t&&"object"==typeof t?(t=EJSON.clone(t),c(t),t):n},EJSON.stringify=function(t){return JSON.stringify(EJSON.toJSONValue(t))},EJSON.parse=function(t){return EJSON.fromJSONValue(JSON.parse(t))},EJSON.isBinary=function(t){return"undefined"!=typeof Uint8Array&&t instanceof Uint8Array||t&&t.$Uint8ArrayPolyfill},EJSON.equals=function(t,n,r){var o,i=!(!r||!r.keyOrderSensitive);if(t===n)return!0;if(!t||!n)return!1;if("object"!=typeof t||"object"!=typeof n)return!1;if(t instanceof Date&&n instanceof Date)return t.valueOf()===n.valueOf();if(EJSON.isBinary(t)&&EJSON.isBinary(n)){if(t.length!==n.length)return!1;for(o=0;o<t.length;o++)if(t[o]!==n[o])return!1;return!0}if("function"==typeof t.equals)return t.equals(n,r);if(t instanceof Array){if(!(n instanceof Array))return!1;if(t.length!==n.length)return!1;for(o=0;o<t.length;o++)if(!EJSON.equals(t[o],n[o],r))return!1;return!0}var u;if(i){var c=[];return e.each(n,function(t,n){c.push(n)}),o=0,u=e.all(t,function(t,e){return o>=c.length?!1:e!==c[o]?!1:EJSON.equals(t,n[c[o]],r)?(o++,!0):!1}),u&&o===c.length}return o=0,u=e.all(t,function(t,i){return e.has(n,i)&&EJSON.equals(t,n[i],r)?(o++,!0):!1}),u&&e.size(n)===o},EJSON.clone=function(t){var n;if("object"!=typeof t)return t;if(null===t)return null;if(t instanceof Date)return new Date(t.getTime());if(EJSON.isBinary(t)){n=EJSON.newBinary(t.length);for(var r=0;r<t.length;r++)n[r]=t[r];return n}if(e.isArray(t)||e.isArguments(t)){for(n=[],r=0;r<t.length;r++)n[r]=EJSON.clone(t[r]);return n}return"function"==typeof t.clone?t.clone():(n={},e.each(t,function(t,e){n[e]=EJSON.clone(t)}),n)},n.exports=EJSON},{lodash:"z2coUu"}],6:[function(t,n){var e,r,o,i,u=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};i=t("lodash"),o=t("./utils").processFind,n.exports=r=function(){function t(t,n){this.localDb=t,this.remoteDb=n,this.collections={}}return t.prototype.addCollection=function(t,n,r,o){var u,c;return i.isFunction(n)&&(c=[{},n,r],n=c[0],r=c[1],o=c[2]),u=new e(t,this.localDb[t],this.remoteDb[t],n),this[t]=u,this.collections[t]=u,null!=r?r():void 0},t.prototype.removeCollection=function(t,n){return delete this[t],delete this.collections[t],null!=n?n():void 0},t.prototype.upload=function(t,n){var e,r;return e=i.values(this.collections),(r=function(){return function(t,n,e){var o;return o=i.first(t),o?o.upload(function(){return r(i.rest(t),n,e)},function(t){return e(t)}):n()}}(this))(e,t,n)},t}(),e=function(){function t(t,n,e,r){this.name=t,this.localCol=n,this.remoteCol=e,r=r||{},i.defaults(r,{caching:!0}),this.caching=r.caching}return t.prototype.find=function(t,n){return null==n&&(n={}),{fetch:function(e){return function(r,o){return e._findFetch(t,n,r,o)}}(this)}},t.prototype.findOne=function(t,n,e,r){var o,c,s;if(null==n&&(n={}),i.isFunction(n)&&(s=[{},n,e],n=s[0],e=s[1],r=s[2]),o=n.mode||(this.caching?"hybrid":"remote"),"hybrid"===o||"local"===o)return n.limit=1,this.localCol.findOne(t,n,function(u){return function(c){var s,a;if(!c||(e(c),"local"!==o))return a=function(o){var s,a;return s=function(){return u.localCol.findOne(t,n,function(t){return i.isEqual(c,t)?c?void 0:e(null):e(t)})},a=o?[o]:[],u.localCol.cache(a,t,n,s,r)},s=function(){return c?void 0:e(null)},u.remoteCol.findOne(t,i.omit(n,"fields"),a,s)}}(this),r);if("remote"===o)return t._id?(c=function(n){return function(o){return n.localCol.pendingUpserts(function(r){var c;return c=i.findWhere(r,{_id:t._id}),c?e(c):n.localCol.pendingRemoves(function(n){var r;return r=t._id,e(u.call(n,r)>=0?null:o)})},r)}}(this),this.remoteCol.findOne(t,n,c,r)):this.find(t,n).fetch(function(){return function(t){return e(t.length>0?t[0]:null)}}(this),function(o){return function(i){return o.caching?o.localCol.findOne(t,n,e,r):r?r(i):void 0}}(this));throw new Error("Unknown mode")},t.prototype._findFetch=function(t,n,e,r){var u,c,s,a;if(c=n.mode||(this.caching?"hybrid":"remote"),"hybrid"===c)return u=function(o){return function(u){var c;return e(u),c=function(c){var s;return s=function(){var c;return c=function(t){return i.isEqual(u,t)?void 0:e(t)},o.localCol.find(t,n).fetch(c,r)},o.localCol.cache(c,t,n,s,r)},o.remoteCol.find(t,i.omit(n,"fields")).fetch(c)}}(this),this.localCol.find(t,n).fetch(u,r);if("local"===c)return this.localCol.find(t,n).fetch(e,r);if("remote"===c)return a=function(r){return function(u){var c;return c=u,r.localCol.pendingRemoves(function(s){var a;return s.length>0&&(a=i.object(i.map(s,function(t){return[t,t]})),c=i.filter(u,function(t){return!i.has(a,t._id)})),r.localCol.pendingUpserts(function(r){var u;return r.length>0&&(u=i.object(i.pluck(r,"_id"),i.pluck(r,"_id")),c=i.filter(c,function(t){return!i.has(u,t._id)}),c=c.concat(r),c=o(c,t,n)),e(c)})})}}(this),s=function(o){return function(i){return o.caching?o.localCol.find(t,n).fetch(e,r):r?r(i):void 0}}(this),this.remoteCol.find(t,n).fetch(a,s);throw new Error("Unknown mode")},t.prototype.upsert=function(t,n,e){return this.localCol.upsert(t,function(){return function(t){return null!=n?n(t):void 0}}(this),e)},t.prototype.remove=function(t,n,e){return this.localCol.remove(t,function(){return function(){return null!=n?n():void 0}}(this),e)},t.prototype.upload=function(t,n){var e,r;return r=function(t){return function(n,e,o){var u;return u=i.first(n),u?t.remoteCol.upsert(u,function(c){return t.localCol.resolveUpsert(u,function(){return t.caching?t.localCol.cacheOne(c,function(){return r(i.rest(n),e,o)},o):t.localCol.remove(u._id,function(){return t.localCol.resolveRemove(u._id,function(){return r(i.rest(n),e,o)},o)},o)},o)},function(c){return 410===c.status||403===c.status?t.localCol.remove(u._id,function(){return t.localCol.resolveRemove(u._id,function(){return 410===c.status?r(i.rest(n),e,o):o(c)},o)},o):o(c)}):e()}}(this),e=function(t){return function(n,r,o){var u;return u=i.first(n),u?t.remoteCol.remove(u,function(){return t.localCol.resolveRemove(u,function(){return e(i.rest(n),r,o)},o)},function(c){return 410===c.status||403===c.status?t.localCol.resolveRemove(u,function(){return 410===c.status?e(i.rest(n),r,o):o(c)},o):o(c)},o):r()}}(this),this.localCol.pendingUpserts(function(o){return function(i){return r(i,function(){return o.localCol.pendingRemoves(function(r){return e(r,t,n)},n)},n)}}(this),n)},t}()},{"./utils":13,lodash:"z2coUu"}],7:[function(t,n){var e,r,o,i,u,c,s,a;a=t("lodash"),i=t("async"),r=t("idb-wrapper"),c=t("./utils").createUid,s=t("./utils").processFind,u=t("./selector").compileSort,n.exports=o=function(){function t(t,n,e){this.collections={},this.store=new r({dbVersion:1,storeName:"minimongo_"+t.namespace,keyPath:["col","doc._id"],autoIncrement:!1,onStoreReady:function(t){return function(){return n?n(t):void 0}}(this),onError:e,indexes:[{name:"col",keyPath:"col",unique:!1,multiEntry:!1},{name:"col-state",keyPath:["col","state"],unique:!1,multiEntry:!1}]})}return t.prototype.addCollection=function(t,n){var r;return r=new e(t,this.store),this[t]=r,this.collections[t]=r,n?n():void 0},t.prototype.removeCollection=function(t,n,e){return delete this[t],delete this.collections[t],this.store.query(function(t){return function(r){var o;return o=a.map(r,function(t){return[t.col,t.doc._id]}),o.length>0?t.store.removeBatch(o,function(){return null!=n?n():void 0},e):null!=n?n():void 0}}(this),{index:"col",keyRange:this.store.makeKeyRange({only:t}),onError:e})},t}(),e=function(){function t(t,n){this.name=t,this.store=n}return t.prototype.find=function(t,n){return{fetch:function(e){return function(r,o){return e._findFetch(t,n,r,o)}}(this)}},t.prototype.findOne=function(t,n,e,r){var o;return a.isFunction(n)&&(o=[{},n,e],n=o[0],e=o[1],r=o[2]),this.find(t,n).fetch(function(t){return null!=e?e(t.length>0?t[0]:null):void 0},r)},t.prototype._findFetch=function(t,n,e,r){return this.store.query(function(){return function(r){return r=a.filter(r,function(t){return"removed"!==t.state}),null!=e?e(s(a.pluck(r,"doc"),t,n)):void 0}}(this),{index:"col",keyRange:this.store.makeKeyRange({only:this.name}),onError:r})},t.prototype.upsert=function(t,n,e){var r,o,i,u,s;for(o=t,a.isArray(o)||(o=[o]),u=0,s=o.length;s>u;u++)r=o[u],r._id||(r._id=c());return i=a.map(o,function(t){return function(n){return{col:t.name,state:"upserted",doc:n}}}(this)),this.store.putBatch(i,function(){return function(){return n?n(t):void 0}}(this),e)},t.prototype.remove=function(t,n,e){return this.store.get([this.name,t],function(r){return function(o){return null==o&&(o={col:r.name,doc:{_id:t}}),o.state="removed",r.store.put(o,function(){return n?n(t):void 0},e)}}(this))},t.prototype.cache=function(t,n,e,r,o){var i,c,s;return s=function(i){return function(){var c,s;return c=a.object(a.pluck(t,"_id"),t),e.sort&&(s=u(e.sort)),i.find(n,e).fetch(function(n){var u,l;return l=[],u=a.map(n,function(t){return[i.name,t._id]}),0===u.length?void(null!=r&&r()):i.store.getBatch(u,function(u){var f,d,h,p,m;for(f=p=0,m=u.length;m>=0?m>p:p>m;f=m>=0?++p:--p)if(d=u[f],h=n[f],!c[h._id]&&d&&"cached"===d.state){if(e.sort&&e.limit&&t.length===e.limit&&s(h,a.last(t))>=0)continue;l.push([i.name,h._id])}return l.length>0?i.store.removeBatch(l,function(){return null!=r?r():void 0},o):null!=r?r():void 0},o)},o)}}(this),0===t.length?s():(i=a.map(t,function(t){return function(n){return[t.name,n._id]}}(this)),c=[],this.store.getBatch(i,function(n){return function(e){var r,i,u,a,l;for(i=a=0,l=e.length;l>=0?l>a:a>l;i=l>=0?++a:--a)u=e[i],r=t[i],(null==u||"cached"===u.state)&&(!u||!r._rev||!u.doc._rev||r._rev>=u.doc._rev)&&c.push({col:n.name,state:"cached",doc:r});return c.length>0?n.store.putBatch(c,s,o):s()}}(this),o))},t.prototype.pendingUpserts=function(t,n){return this.store.query(function(){return function(n){return null!=t?t(a.pluck(n,"doc")):void 0}}(this),{index:"col-state",keyRange:this.store.makeKeyRange({only:[this.name,"upserted"]}),onError:n})},t.prototype.pendingRemoves=function(t,n){return this.store.query(function(){return function(n){return null!=t?t(a.pluck(a.pluck(n,"doc"),"_id")):void 0}}(this),{index:"col-state",keyRange:this.store.makeKeyRange({only:[this.name,"removed"]}),onError:n})},t.prototype.resolveUpsert=function(t,n,e){var r,o;return r=t,a.isArray(r)||(r=[r]),o=a.map(r,function(t){return function(n){return[t.name,n._id]}}(this)),this.store.getBatch(o,function(o){return function(i){var u,c,s,l,f;for(c=[],u=l=0,f=r.length;f>=0?f>l:l>f;u=f>=0?++l:--l)s=i[u],s&&"upserted"===s.state&&a.isEqual(s.doc,r[u])&&(s.state="cached",c.push(s));return c.length>0?o.store.putBatch(c,function(){return n?n(t):void 0},e):n?n(t):void 0}}(this),e)},t.prototype.resolveRemove=function(t,n,e){return this.store.get([this.name,t],function(r){return function(o){return"removed"===o.state?r.store.remove([r.name,t],function(){return null!=n?n():void 0},e):void 0}}(this))},t.prototype.seed=function(t,n,e){return this.store.get([this.name,t._id],function(r){return function(o){return null==o?(o={col:r.name,state:"cached",doc:t},r.store.put(o,function(){return null!=n?n():void 0},e)):null!=n?n():void 0}}(this))},t.prototype.cacheOne=function(t,n,e){return this.store.get([this.name,t._id],function(r){return function(o){return o&&t._rev&&o.doc._rev&&t._rev<o.doc._rev?void(null!=n&&n()):(null==o&&(o={col:r.name,state:"cached",doc:t}),"cached"===o.state?(o.doc=t,r.store.put(o,function(){return null!=n?n():void 0},e)):null!=n?n():void 0)}}(this))},t}()},{"./selector":12,"./utils":13,async:16,"idb-wrapper":19,lodash:"z2coUu"}],8:[function(t,n){var e,r,o,i,u,c;c=t("lodash"),i=t("./utils").createUid,u=t("./utils").processFind,o=t("./selector").compileSort,n.exports=r=function(){function t(t,n){this.collections={},t&&t.namespace&&window.localStorage&&(this.namespace=t.namespace),n&&n(this)}return t.prototype.addCollection=function(t,n){var r,o;return this.namespace&&(o=this.namespace+"."+t),r=new e(t,o),this[t]=r,this.collections[t]=r,null!=n?n():void 0},t.prototype.removeCollection=function(t,n){var e,r,o,i,u,c,s;if(this.namespace&&window.localStorage){for(o=[],e=i=0,s=window.localStorage.length;s>=0?s>i:i>s;e=s>=0?++i:--i)o.push(window.localStorage.key(e));for(u=0,c=o.length;c>u;u++)r=o[u],r.substring(0,this.namespace.length+1)===this.namespace+"."&&window.localStorage.removeItem(r)}return delete this[t],delete this.collections[t],null!=n?n():void 0},t}(),e=function(){function t(t,n){this.name=t,this.namespace=n,this.items={},this.upserts={},this.removes={},window.localStorage&&null!=n&&this.loadStorage()}return t.prototype.loadStorage=function(){var t,n,e,r,o,i,u,s,a;for(this.itemNamespace=this.namespace+"_",t=i=0,a=window.localStorage.length;a>=0?a>i:i>a;t=a>=0?++i:--i)e=window.localStorage.key(t),e.substring(0,this.itemNamespace.length)===this.itemNamespace&&(n=JSON.parse(window.localStorage[e]),this.items[n._id]=n);for(o=window.localStorage[this.namespace+"upserts"]?JSON.parse(window.localStorage[this.namespace+"upserts"]):[],u=0,s=o.length;s>u;u++)e=o[u],this.upserts[e]=this.items[e];return r=window.localStorage[this.namespace+"removes"]?JSON.parse(window.localStorage[this.namespace+"removes"]):[],this.removes=c.object(c.pluck(r,"_id"),r)},t.prototype.find=function(t,n){return{fetch:function(e){return function(r,o){return e._findFetch(t,n,r,o)}}(this)}},t.prototype.findOne=function(t,n,e,r){var o;return c.isFunction(n)&&(o=[{},n,e],n=o[0],e=o[1],r=o[2]),this.find(t,n).fetch(function(t){return null!=e?e(t.length>0?t[0]:null):void 0},r)},t.prototype._findFetch=function(t,n,e){return null!=e?e(u(this.items,t,n)):void 0},t.prototype.upsert=function(t,n){var e,r,o,u;for(r=t,c.isArray(r)||(r=[r]),o=0,u=r.length;u>o;o++)e=r[o],e._id||(e._id=i()),this._putItem(e),this._putUpsert(e);return n?n(t):void 0},t.prototype.remove=function(t,n){return c.has(this.items,t)?(this._putRemove(this.items[t]),this._deleteItem(t),this._deleteUpsert(t)):this._putRemove({_id:t}),null!=n?n():void 0},t.prototype._putItem=function(t){return this.items[t._id]=t,this.namespace?window.localStorage[this.itemNamespace+t._id]=JSON.stringify(t):void 0},t.prototype._deleteItem=function(t){return delete this.items[t],this.namespace?window.localStorage.removeItem(this.itemNamespace+t):void 0},t.prototype._putUpsert=function(t){return this.upserts[t._id]=t,this.namespace?window.localStorage[this.namespace+"upserts"]=JSON.stringify(c.keys(this.upserts)):void 0},t.prototype._deleteUpsert=function(t){return delete this.upserts[t],this.namespace?window.localStorage[this.namespace+"upserts"]=JSON.stringify(c.keys(this.upserts)):void 0},t.prototype._putRemove=function(t){return this.removes[t._id]=t,this.namespace?window.localStorage[this.namespace+"removes"]=JSON.stringify(c.values(this.removes)):void 0},t.prototype._deleteRemove=function(t){return delete this.removes[t],this.namespace?window.localStorage[this.namespace+"removes"]=JSON.stringify(c.values(this.removes)):void 0},t.prototype.cache=function(t,n,e,r,i){var u,s,a,l,f;for(l=0,f=t.length;f>l;l++)u=t[l],this.cacheOne(u);return s=c.object(c.pluck(t,"_id"),t),e.sort&&(a=o(e.sort)),this.find(n,e).fetch(function(n){return function(o){var i,u,l;for(u=0,l=o.length;l>u;u++)if(i=o[u],!s[i._id]&&!c.has(n.upserts,i._id)){if(e.sort&&e.limit&&t.length===e.limit&&a(i,c.last(t))>=0)continue;n._deleteItem(i._id)}return null!=r?r():void 0}}(this),i)},t.prototype.pendingUpserts=function(t){return t(c.values(this.upserts))},t.prototype.pendingRemoves=function(t){return t(c.pluck(this.removes,"_id"))},t.prototype.resolveUpsert=function(t,n){var e,r,o,i;for(r=t,c.isArray(r)||(r=[r]),o=0,i=r.length;i>o;o++)e=r[o],this.upserts[e._id]&&c.isEqual(e,this.upserts[e._id])&&this._deleteUpsert(e._id);return null!=n?n():void 0},t.prototype.resolveRemove=function(t,n){return this._deleteRemove(t),null!=n?n():void 0},t.prototype.seed=function(t,n){return c.has(this.items,t._id)||c.has(this.removes,t._id)||this._putItem(t),null!=n?n():void 0},t.prototype.cacheOne=function(t,n){var e;return c.has(this.upserts,t._id)||c.has(this.removes,t._id)||(e=this.items[t._id],(!e||!t._rev||!e._rev||t._rev>=e._rev)&&this._putItem(t)),null!=n?n():void 0},t}()},{"./selector":12,"./utils":13,lodash:"z2coUu"}],9:[function(t,n){var e,r,o,i,u,c;c=t("lodash"),i=t("./utils").createUid,u=t("./utils").processFind,o=t("./selector").compileSort,n.exports=r=function(){function t(t,n){this.collections={},n&&n(this)}return t.prototype.addCollection=function(t,n){var r;return r=new e(t),this[t]=r,this.collections[t]=r,null!=n?n():void 0},t.prototype.removeCollection=function(t,n){return delete this[t],delete this.collections[t],null!=n?n():void 0},t}(),e=function(){function t(t){this.name=t,this.items={},this.upserts={},this.removes={}}return t.prototype.find=function(t,n){return{fetch:function(e){return function(r,o){return e._findFetch(t,n,r,o)}}(this)}},t.prototype.findOne=function(t,n,e,r){var o;return c.isFunction(n)&&(o=[{},n,e],n=o[0],e=o[1],r=o[2]),this.find(t,n).fetch(function(t){return null!=e?e(t.length>0?t[0]:null):void 0},r)},t.prototype._findFetch=function(t,n,e){return null!=e?e(u(this.items,t,n)):void 0},t.prototype.upsert=function(t,n){var e,r,o,u;for(r=t,c.isArray(r)||(r=[r]),o=0,u=r.length;u>o;o++)e=r[o],e._id||(e._id=i()),this.items[e._id]=e,this.upserts[e._id]=e;return n?n(t):void 0},t.prototype.remove=function(t,n){return c.has(this.items,t)?(this.removes[t]=this.items[t],delete this.items[t],delete this.upserts[t]):this.removes[t]={_id:t},null!=n?n():void 0},t.prototype.cache=function(t,n,e,r,i){var u,s,a,l,f;for(l=0,f=t.length;f>l;l++)u=t[l],this.cacheOne(u);return s=c.object(c.pluck(t,"_id"),t),e.sort&&(a=o(e.sort)),this.find(n,e).fetch(function(n){return function(o){var i,u,l;for(u=0,l=o.length;l>u;u++)if(i=o[u],!s[i._id]&&!c.has(n.upserts,i._id)){if(e.sort&&e.limit&&t.length===e.limit&&a(i,c.last(t))>=0)continue;delete n.items[i._id]}return null!=r?r():void 0}}(this),i)},t.prototype.pendingUpserts=function(t){return t(c.values(this.upserts))},t.prototype.pendingRemoves=function(t){return t(c.pluck(this.removes,"_id"))},t.prototype.resolveUpsert=function(t,n){var e,r,o,i;for(r=t,c.isArray(r)||(r=[r]),o=0,i=r.length;i>o;o++)e=r[o],this.upserts[e._id]&&c.isEqual(e,this.upserts[e._id])&&delete this.upserts[e._id];return null!=n?n():void 0},t.prototype.resolveRemove=function(t,n){return delete this.removes[t],null!=n?n():void 0},t.prototype.seed=function(t,n){return c.has(this.items,t._id)||c.has(this.removes,t._id)||(this.items[t._id]=t),null!=n?n():void 0},t.prototype.cacheOne=function(t,n){var e;return c.has(this.upserts,t._id)||c.has(this.removes,t._id)||(e=this.items[t._id],(!e||!t._rev||!e._rev||t._rev>=e._rev)&&(this.items[t._id]=t)),null!=n?n():void 0},t}()},{"./selector":12,"./utils":13,lodash:"z2coUu"}],10:[function(t,n){var e,r,o,i,u;u=t("lodash"),e=t("jquery"),i=t("./utils").createUid,n.exports=o=function(){function t(t,n){this.url=t,this.client=n,this.collections={}}return t.prototype.addCollection=function(t){var n;return n=new r(t,this.url+t,this.client),this[t]=n,this.collections[t]=n},t.prototype.removeCollection=function(t){return delete this[t],delete this.collections[t]},t}(),r=function(){function t(t,n,e){this.name=t,this.url=n,this.client=e}return t.prototype.find=function(t,n){return null==n&&(n={}),{fetch:function(r){return function(o,i){var u,c;return u={},n.sort&&(u.sort=JSON.stringify(n.sort)),n.limit&&(u.limit=n.limit),n.fields&&(u.fields=JSON.stringify(n.fields)),r.client&&(u.client=r.client),u.selector=JSON.stringify(t||{}),-1!==navigator.userAgent.toLowerCase().indexOf("android 2.3")&&(u._=(new Date).getTime()),c=e.getJSON(r.url,u),c.done(function(t){return o(t)}),c.fail(function(t){return i?i(t):void 0})}}(this)}},t.prototype.findOne=function(t,n,r,o){var i,c,s;return null==n&&(n={}),u.isFunction(n)&&(s=[{},n,r],n=s[0],r=s[1],o=s[2]),i={},n.sort&&(i.sort=JSON.stringify(n.sort)),i.limit=1,this.client&&(i.client=this.client),i.selector=JSON.stringify(t||{}),-1!==navigator.userAgent.toLowerCase().indexOf("android 2.3")&&(i._=(new Date).getTime()),c=e.getJSON(this.url,i),c.done(function(){return function(t){return r(t[0]||null)}}(this)),c.fail(function(){return function(t){return o?o(t):void 0}}(this))},t.prototype.upsert=function(t,n,r){var o,u;if(!this.client)throw new Error("Client required to upsert");return t._id||(t._id=i()),u=-1!==navigator.userAgent.toLowerCase().indexOf("android 2.3")?this.url+"?client="+this.client+"&_="+(new Date).getTime():this.url+"?client="+this.client,o=e.ajax(u,{data:JSON.stringify(t),contentType:"application/json",type:"POST"}),o.done(function(){return function(t){return n(t||null)}}(this)),o.fail(function(){return function(t){return r?r(t):void 0}}(this))},t.prototype.remove=function(t,n,r){var o;if(!this.client)throw new Error("Client required to remove");return o=e.ajax(this.url+"/"+t+"?client="+this.client,{type:"DELETE"}),o.done(function(){return function(){return n()}}(this)),o.fail(function(){return function(t){return 410===t.status?n():r?r(t):void 0}}(this))},t}()},{"./utils":13,jquery:"dsrzUy",lodash:"z2coUu"}],11:[function(t,n){var e,r,o,i,u,c,s,a;a=t("lodash"),o=t("async"),u=t("./utils").createUid,s=t("./utils").processFind,i=t("./selector").compileSort,c=function(){},n.exports=r=function(){function t(t,n,e){var r;return this.collections={},this.db=window.openDatabase("minimongo_"+t.namespace,"1.0","Minimongo:"+t.namespace,5242880),this.db?(r=function(){return function(t){return t.executeSql("CREATE TABLE IF NOT EXISTS docs (\n  col TEXT NOT NULL,\n  id TEXT NOT NULL,\n  state TEXT NOT NULL,\n  doc TEXT, \n  PRIMARY KEY (col, id));",[],c,e)}}(this),void this.db.transaction(r,e,function(t){return function(){return n?n(t):void 0}}(this))):e("Failed to create database")}return t.prototype.addCollection=function(t,n){var r;return r=new e(t,this.db),this[t]=r,this.collections[t]=r,n?n():void 0},t.prototype.removeCollection=function(t,n,e){return delete this[t],delete this.collections[t],this.db.transaction(function(){return function(r){return r.executeSql("DELETE FROM docs WHERE col = ?",[t],n,e)}}(this),e)},t}(),e=function(){function t(t,n){this.name=t,this.db=n}return t.prototype.find=function(t,n){return{fetch:function(e){return function(r,o){return e._findFetch(t,n,r,o)}}(this)}},t.prototype.findOne=function(t,n,e,r){var o;return a.isFunction(n)&&(o=[{},n,e],n=o[0],e=o[1],r=o[2]),this.find(t,n).fetch(function(t){return null!=e?e(t.length>0?t[0]:null):void 0},r)},t.prototype._findFetch=function(t,n,e,r){return r=r||function(){},this.db.readTransaction(function(o){return function(i){return i.executeSql("SELECT * FROM docs WHERE col = ?",[o.name],function(r,o){var i,u,c,a,l;for(i=[],u=a=0,l=o.rows.length;l>=0?l>a:a>l;u=l>=0?++a:--a)c=o.rows.item(u),"removed"!==c.state&&i.push(JSON.parse(c.doc));return null!=e?e(s(i,t,n)):void 0},r)}}(this),r)},t.prototype.upsert=function(t,n,e){var r,o,i,s;for(e=e||function(){},o=t,a.isArray(o)||(o=[o]),i=0,s=o.length;s>i;i++)r=o[i],r._id||(r._id=u());return this.db.transaction(function(t){return function(n){var i,u,s;for(s=[],i=0,u=o.length;u>i;i++)r=o[i],s.push(n.executeSql("INSERT OR REPLACE INTO docs (col, id, state, doc) VALUES (?, ?, ?, ?)",[t.name,r._id,"upserted",JSON.stringify(r)],c,e));return s}}(this),e,function(){return function(){return n?n(t):void 0}}(this))},t.prototype.remove=function(t,n,e){return e=e||function(){},this.db.transaction(function(r){return function(o){return o.executeSql("SELECT * FROM docs WHERE col = ? AND id = ?",[r.name,t],function(o,i){return i.rows.length>0?o.executeSql('UPDATE docs SET state="removed" WHERE col = ? AND id = ?',[r.name,t],function(){return n?n(t):void 0},e):o.executeSql("INSERT INTO docs (col, id, state, doc) VALUES (?, ?, ?, ?)",[r.name,t,"removed",JSON.stringify({_id:t})],function(){return n?n(t):void 0},e)},e)}}(this),e)},t.prototype.cache=function(t,n,e,r,u){return u=u||function(){},this.db.transaction(function(c){return function(s){return o.eachSeries(t,function(t,n){return s.executeSql("SELECT * FROM docs WHERE col = ? AND id = ?",[c.name,t._id],function(e,r){var o;return 0===r.rows.length||"cached"===r.rows.item(0).state?(o=r.rows.length>0?JSON.parse(r.rows.item(0).doc):null,!o||!t._rev||!o._rev||t._rev>=o._rev?e.executeSql("INSERT OR REPLACE INTO docs (col, id, state, doc) VALUES (?, ?, ?, ?)",[c.name,t._id,"cached",JSON.stringify(t)],function(){return n()},u):n()):n()},n,u)},function(s){var l,f;return s?void(u&&u(s)):(l=a.object(a.pluck(t,"_id"),t),e.sort&&(f=i(e.sort)),c.find(n,e).fetch(function(n){return c.db.transaction(function(i){return o.eachSeries(n,function(n,r){return i.executeSql("SELECT * FROM docs WHERE col = ? AND id = ?",[c.name,n._id],function(o,i){return!l[n._id]&&i.rows.length>0&&"cached"===i.rows.item(0).state?e.sort&&e.limit&&t.length===e.limit&&f(n,a.last(t))>=0?r():o.executeSql("DELETE FROM docs WHERE col = ? AND id = ?",[c.name,n._id],function(){return r()},u):r()},r,u)},function(t){return null!=t?void(null!=u&&u(t)):null!=r?r():void 0})},u)},u))})}}(this),u)},t.prototype.pendingUpserts=function(t,n){return n=n||function(){},this.db.readTransaction(function(e){return function(r){return r.executeSql("SELECT * FROM docs WHERE col = ? AND state = ?",[e.name,"upserted"],function(n,e){var r,o,i,u,c;for(r=[],o=u=0,c=e.rows.length;c>=0?c>u:u>c;o=c>=0?++u:--u)i=e.rows.item(o),r.push(JSON.parse(i.doc));return null!=t?t(r):void 0},n)}}(this),n)},t.prototype.pendingRemoves=function(t,n){return n=n||function(){},this.db.readTransaction(function(e){return function(r){return r.executeSql("SELECT * FROM docs WHERE col = ? AND state = ?",[e.name,"removed"],function(n,e){var r,o,i,u,c;for(r=[],o=u=0,c=e.rows.length;c>=0?c>u:u>c;o=c>=0?++u:--u)i=e.rows.item(o),r.push(JSON.parse(i.doc)._id);return null!=t?t(r):void 0},n)}}(this),n)},t.prototype.resolveUpsert=function(t,n,e){var r;return e=e||function(){},r=t,a.isArray(r)||(r=[r]),this.db.transaction(function(i){return function(u){return o.eachSeries(r,function(t,n){return u.executeSql("SELECT * FROM docs WHERE col = ? AND id = ?",[i.name,t._id],function(r,o){return o.rows.length>0&&"upserted"===o.rows.item(0).state&&a.isEqual(JSON.parse(o.rows.item(0).doc),t)?(r.executeSql('UPDATE docs SET state="cached" WHERE col = ? AND id = ?',[i.name,t._id],c,e),n()):n()},e)},function(r){return r?e(r):n?n(t):void 0})}}(this),e)},t.prototype.resolveRemove=function(t,n,e){return e=e||function(){},this.db.transaction(function(r){return function(o){return o.executeSql('DELETE FROM docs WHERE state="removed" AND col = ? AND id = ?',[r.name,t],function(){return n?n(t):void 0},e)}}(this),e)},t.prototype.seed=function(t,n,e){return e=e||function(){},this.db.transaction(function(r){return function(o){return o.executeSql("SELECT * FROM docs WHERE col = ? AND id = ?",[r.name,t._id],function(o,i){return 0===i.rows.length?o.executeSql("INSERT INTO docs (col, id, state, doc) VALUES (?, ?, ?, ?)",[r.name,t._id,"cached",JSON.stringify(t)],function(){return n?n(t):void 0},e):n?n(t):void 0},e)}}(this),e)},t.prototype.cacheOne=function(t,n,e){return e=e||function(){},this.db.transaction(function(r){return function(o){return o.executeSql("SELECT * FROM docs WHERE col = ? AND id = ?",[r.name,t._id],function(o,i){var u;if(0===i.rows.length||"cached"===i.rows.item(0).state){if(u=i.rows.length>0?JSON.parse(i.rows.item(0).doc):null,!u||!t._rev||!u._rev||t._rev>=u._rev)return o.executeSql("INSERT OR REPLACE INTO docs (col, id, state, doc) VALUES (?, ?, ?, ?)",[r.name,t._id,"cached",JSON.stringify(t)],function(){return n?n(t):void 0},e);if(n)return n(t)}else if(n)return n(t)},e)}}(this),e)},t}()},{"./selector":12,"./utils":13,async:16,lodash:"z2coUu"}],12:[function(t,n,e){LocalCollection={},EJSON=t("./EJSON");var r=t("lodash"),o=function(t){return r.isArray(t)&&!EJSON.isBinary(t)},i=function(t,n){return o(t)?r.any(t,n):n(t)},u=function(t,n){return n(t)?!0:o(t)&&r.any(t,n)},c=function(t){var n=void 0;for(var e in t){var r="$"===e.substr(0,1);if(void 0===n)n=r;else if(n!==r)throw new Error("Inconsistent selector: "+t)}return!!n},s=function(t){if(null==t)return function(t){return i(t,function(t){return null==t})};if(!r.isObject(t))return function(n){return i(n,function(n){return n===t})};if(t instanceof RegExp)return function(n){return void 0===n?!1:i(n,function(n){return t.test(n)})};if(o(t))return function(n){return o(n)?u(n,function(n){return LocalCollection._f._equal(t,n)}):!1};if(c(t)){var n=[];return r.each(t,function(e,o){if(!r.has(l,o))throw new Error("Unrecognized operator: "+o);n.push(l[o](e,t.$options))}),function(t){return r.all(n,function(n){return n(t)})}}return function(n){return i(n,function(n){return LocalCollection._f._equal(t,n)})}},a={$and:function(t){if(!o(t)||r.isEmpty(t))throw Error("$and/$or/$nor must be nonempty array");var n=r.map(t,f);return function(t){return r.all(n,function(n){return n(t)
})}},$or:function(t){if(!o(t)||r.isEmpty(t))throw Error("$and/$or/$nor must be nonempty array");var n=r.map(t,f);return function(t){return r.any(n,function(n){return n(t)})}},$nor:function(t){if(!o(t)||r.isEmpty(t))throw Error("$and/$or/$nor must be nonempty array");var n=r.map(t,f);return function(t){return r.all(n,function(n){return!n(t)})}},$where:function(t){return t instanceof Function||(t=Function("return "+t)),function(n){return t.call(n)}}},l={$in:function(t){if(!o(t))throw new Error("Argument to $in must be array");return function(n){return u(n,function(n){return r.any(t,function(t){return LocalCollection._f._equal(t,n)})})}},$all:function(t){if(!o(t))throw new Error("Argument to $all must be array");return function(n){return o(n)?r.all(t,function(t){return r.any(n,function(n){return LocalCollection._f._equal(t,n)})}):!1}},$lt:function(t){return function(n){return i(n,function(n){return LocalCollection._f._cmp(n,t)<0})}},$lte:function(t){return function(n){return i(n,function(n){return LocalCollection._f._cmp(n,t)<=0})}},$gt:function(t){return function(n){return i(n,function(n){return LocalCollection._f._cmp(n,t)>0})}},$gte:function(t){return function(n){return i(n,function(n){return LocalCollection._f._cmp(n,t)>=0})}},$ne:function(t){return function(n){return!u(n,function(n){return LocalCollection._f._equal(n,t)})}},$nin:function(t){if(!o(t))throw new Error("Argument to $nin must be array");var n=l.$in(t);return function(t){return void 0===t?!0:!n(t)}},$exists:function(t){return function(n){return t===(void 0!==n)}},$mod:function(t){var n=t[0],e=t[1];return function(t){return i(t,function(t){return t%n===e})}},$size:function(t){return function(n){return o(n)&&t===n.length}},$type:function(t){return function(n){return void 0===n?!1:i(n,function(n){return LocalCollection._f._type(n)===t})}},$regex:function(t,n){if(void 0!==n){if(/[^gim]/.test(n))throw new Error("Only the i, m, and g regexp options are supported");var e=t instanceof RegExp?t.source:t;t=new RegExp(e,n)}else t instanceof RegExp||(t=new RegExp(t));return function(n){return void 0===n?!1:i(n,function(n){return t.test(n)})}},$options:function(){return function(){return!0}},$elemMatch:function(t){var n=f(t);return function(t){return o(t)?r.any(t,function(t){return n(t)}):!1}},$not:function(t){var n=s(t);return function(t){return!n(t)}},$near:function(){return function(){return!0}},$geoIntersects:function(){return function(){return!0}}};LocalCollection._f={_type:function(t){return"number"==typeof t?1:"string"==typeof t?2:"boolean"==typeof t?8:o(t)?4:null===t?10:t instanceof RegExp?11:"function"==typeof t?13:t instanceof Date?9:EJSON.isBinary(t)?5:t instanceof Meteor.Collection.ObjectID?7:3},_equal:function(t,n){return EJSON.equals(t,n,{keyOrderSensitive:!0})},_typeorder:function(t){return[-1,1,2,3,4,5,-1,6,7,8,0,9,-1,100,2,100,1,8,1][t]},_cmp:function(t,n){if(void 0===t)return void 0===n?0:-1;if(void 0===n)return 1;var e=LocalCollection._f._type(t),r=LocalCollection._f._type(n),o=LocalCollection._f._typeorder(e),i=LocalCollection._f._typeorder(r);if(o!==i)return i>o?-1:1;if(e!==r)throw Error("Missing type coercion logic in _cmp");if(7===e&&(e=r=2,t=t.toHexString(),n=n.toHexString()),9===e&&(e=r=1,t=t.getTime(),n=n.getTime()),1===e)return t-n;if(2===r)return n>t?-1:t===n?0:1;if(3===e){var u=function(t){var n=[];for(var e in t)n.push(e),n.push(t[e]);return n};return LocalCollection._f._cmp(u(t),u(n))}if(4===e)for(var c=0;;c++){if(c===t.length)return c===n.length?0:-1;if(c===n.length)return 1;var s=LocalCollection._f._cmp(t[c],n[c]);if(0!==s)return s}if(5===e){if(t.length!==n.length)return t.length-n.length;for(c=0;c<t.length;c++){if(t[c]<n[c])return-1;if(t[c]>n[c])return 1}return 0}if(8===e)return t?n?0:1:n?-1:0;if(10===e)return 0;if(11===e)throw Error("Sorting not supported on regular expression");if(13===e)throw Error("Sorting not supported on Javascript code");throw Error("Unknown type to sort")}},LocalCollection._matches=function(t,n){return LocalCollection._compileSelector(t)(n)},LocalCollection._makeLookupFunction=function(t){var n,e,i,u=t.indexOf(".");if(-1===u)n=t;else{n=t.substr(0,u);var c=t.substr(u+1);e=LocalCollection._makeLookupFunction(c),i=/^\d+(\.|$)/.test(c)}return function(t){if(null==t)return[void 0];var u=t[n];return e?o(u)&&0===u.length?[void 0]:((!o(u)||i)&&(u=[u]),Array.prototype.concat.apply([],r.map(u,e))):[u]}};var f=function(t){var n=[];return r.each(t,function(t,e){if("$"===e.substr(0,1)){if(!r.has(a,e))throw new Error("Unrecognized logical operator: "+e);n.push(a[e](t))}else{var o=LocalCollection._makeLookupFunction(e),i=s(t);n.push(function(t){var n=o(t);return r.any(n,i)})}}),function(t){return r.all(n,function(n){return n(t)})}};LocalCollection._compileSelector=function(t){if(t instanceof Function)return function(n){return t.call(n)};if(LocalCollection._selectorIsId(t))return function(n){return EJSON.equals(n._id,t)};if(!t||"_id"in t&&!t._id)return function(){return!1};if("boolean"==typeof t||o(t)||EJSON.isBinary(t))throw new Error("Invalid selector: "+t);return f(t)},LocalCollection._compileSort=function(t){var n=[];if(t instanceof Array)for(var e=0;e<t.length;e++)n.push("string"==typeof t[e]?{lookup:LocalCollection._makeLookupFunction(t[e]),ascending:!0}:{lookup:LocalCollection._makeLookupFunction(t[e][0]),ascending:"desc"!==t[e][1]});else{if("object"!=typeof t)throw Error("Bad sort specification: ",JSON.stringify(t));for(var i in t)n.push({lookup:LocalCollection._makeLookupFunction(i),ascending:t[i]>=0})}if(0===n.length)return function(){return 0};var u=function(t,n){var e,i=!0;return r.each(t,function(t){o(t)||(t=[t]),o(t)&&0===t.length&&(t=[void 0]),r.each(t,function(t){if(i)e=t,i=!1;else{var r=LocalCollection._f._cmp(e,t);(n&&r>0||!n&&0>r)&&(e=t)}})}),e};return function(t,e){for(var r=0;r<n.length;++r){var o=n[r],i=u(o.lookup(t),o.ascending),c=u(o.lookup(e),o.ascending),s=LocalCollection._f._cmp(i,c);if(0!==s)return o.ascending?s:-s}return 0}},e.compileDocumentSelector=f,e.compileSort=LocalCollection._compileSort},{"./EJSON":5,lodash:"z2coUu"}],13:[function(t,n,e){var r,o,i,u,c,s,a,l,f,d;d=t("lodash"),r=t("async"),o=t("bowser"),i=t("./selector").compileDocumentSelector,u=t("./selector").compileSort,e.autoselectLocalDb=function(n,e,r){var i,u,c,s,a;return i=t("./IndexedDb"),s=t("./WebSQLDb"),u=t("./LocalStorageDb"),c=t("./MemoryDb"),a=o.browser,window.cordova?(console.log("Selecting WebSQLDb for Cordova"),new s(n,e,r)):a.android||a.ios||a.chrome||a.safari||a.opera||a.blackberry?(console.log("Selecting WebSQLDb for browser"),new s(n,e,r)):a.firefox&&a.version>=16?(console.log("Selecting IndexedDb for browser"),new i(n,e,r)):(console.log("Selecting LocalStorageDb for fallback"),new u(n,e,r))},e.migrateLocalDb=function(n,e,r,o){var i,u,c,s,a;i=t("./HybridDb"),c=new i(n,e),a=n.collections;for(s in a)u=a[s],e[s]&&c.addCollection(s);return c.upload(r,o)},e.processFind=function(t,n,e){var r;return r=d.filter(d.values(t),i(n)),r=f(n,r),r=l(n,r),e&&e.sort&&r.sort(u(e.sort)),e&&e.limit&&(r=d.first(r,e.limit)),r=e&&e.fields?1===d.first(d.values(e.fields))?d.map(r,function(t){return d.pick(t,d.keys(e.fields).concat(["_id"]))}):d.map(r,function(t){return d.omit(t,d.keys(e.fields))}):d.map(r,function(t){return d.cloneDeep(t)})},e.createUid=function(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(t){var n,e;return n=16*Math.random()|0,e="x"===t?n:3&n|8,e.toString(16)})},f=function(t,n){var e,r,o,i;for(o in t)if(i=t[o],null!=i&&i.$near){if(r=i.$near.$geometry,"Point"!==r.type)break;n=d.filter(n,function(t){return t[o]&&"Point"===t[o].type}),e=d.map(n,function(t){return{doc:t,distance:s(r.coordinates[1],r.coordinates[0],t[o].coordinates[1],t[o].coordinates[0])}}),e=d.filter(e,function(t){return t.distance>=0}),e=d.sortBy(e,"distance"),i.$near.$maxDistance&&(e=d.filter(e,function(t){return t.distance<=i.$near.$maxDistance})),e=d.first(e,100),n=d.pluck(e,"doc")}return n},a=function(t,n){if(!d.isEqual(d.first(n.coordinates[0]),d.last(n.coordinates[0])))throw new Error("First must equal last");return t.coordinates[0]<Math.min.apply(this,d.map(n.coordinates[0],function(t){return t[0]}))?!1:t.coordinates[1]<Math.min.apply(this,d.map(n.coordinates[0],function(t){return t[1]}))?!1:t.coordinates[0]>Math.max.apply(this,d.map(n.coordinates[0],function(t){return t[0]}))?!1:t.coordinates[1]>Math.max.apply(this,d.map(n.coordinates[0],function(t){return t[1]}))?!1:!0},s=function(t,n,e,r){var o,i,u,s,a,l;return o=6371e3,a=c(e-t),l=c(r-n),i=Math.sin(a/2)*Math.sin(a/2)+Math.cos(c(t))*Math.cos(c(e))*Math.sin(l/2)*Math.sin(l/2),u=2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)),s=o*u},c=function(t){return t*(Math.PI/180)},l=function(t,n){var e,r,o;for(r in t)if(o=t[r],null!=o&&o.$geoIntersects){if(e=o.$geoIntersects.$geometry,"Polygon"!==e.type)break;n=d.filter(n,function(t){return t[r]&&"Point"===t[r].type?a(t[r],e):!1})}return n}},{"./HybridDb":6,"./IndexedDb":7,"./LocalStorageDb":8,"./MemoryDb":9,"./WebSQLDb":11,"./selector":12,async:16,bowser:17,lodash:"z2coUu"}],lodash:[function(t,n){n.exports=t("z2coUu")},{}],z2coUu:[function(t,n){n.exports=window._},{}],16:[function(t,n){(function(t){!function(){function e(t){var n=!1;return function(){if(n)throw new Error("Callback was already called.");n=!0,t.apply(r,arguments)}}var r,o,i={};r=this,null!=r&&(o=r.async),i.noConflict=function(){return r.async=o,i};var u=Object.prototype.toString,c=Array.isArray||function(t){return"[object Array]"===u.call(t)},s=function(t,n){if(t.forEach)return t.forEach(n);for(var e=0;e<t.length;e+=1)n(t[e],e,t)},a=function(t,n){if(t.map)return t.map(n);var e=[];return s(t,function(t,r,o){e.push(n(t,r,o))}),e},l=function(t,n,e){return t.reduce?t.reduce(n,e):(s(t,function(t,r,o){e=n(e,t,r,o)}),e)},f=function(t){if(Object.keys)return Object.keys(t);var n=[];for(var e in t)t.hasOwnProperty(e)&&n.push(e);return n};"undefined"!=typeof t&&t.nextTick?(i.nextTick=t.nextTick,i.setImmediate="undefined"!=typeof setImmediate?function(t){setImmediate(t)}:i.nextTick):"function"==typeof setImmediate?(i.nextTick=function(t){setImmediate(t)},i.setImmediate=i.nextTick):(i.nextTick=function(t){setTimeout(t,0)},i.setImmediate=i.nextTick),i.each=function(t,n,r){function o(n){n?(r(n),r=function(){}):(i+=1,i>=t.length&&r())}if(r=r||function(){},!t.length)return r();var i=0;s(t,function(t){n(t,e(o))})},i.forEach=i.each,i.eachSeries=function(t,n,e){if(e=e||function(){},!t.length)return e();var r=0,o=function(){n(t[r],function(n){n?(e(n),e=function(){}):(r+=1,r>=t.length?e():o())})};o()},i.forEachSeries=i.eachSeries,i.eachLimit=function(t,n,e,r){var o=d(n);o.apply(null,[t,e,r])},i.forEachLimit=i.eachLimit;var d=function(t){return function(n,e,r){if(r=r||function(){},!n.length||0>=t)return r();var o=0,i=0,u=0;!function c(){if(o>=n.length)return r();for(;t>u&&i<n.length;)i+=1,u+=1,e(n[i-1],function(t){t?(r(t),r=function(){}):(o+=1,u-=1,o>=n.length?r():c())})}()}},h=function(t){return function(){var n=Array.prototype.slice.call(arguments);return t.apply(null,[i.each].concat(n))}},p=function(t,n){return function(){var e=Array.prototype.slice.call(arguments);return n.apply(null,[d(t)].concat(e))}},m=function(t){return function(){var n=Array.prototype.slice.call(arguments);return t.apply(null,[i.eachSeries].concat(n))}},v=function(t,n,e,r){if(n=a(n,function(t,n){return{index:n,value:t}}),r){var o=[];t(n,function(t,n){e(t.value,function(e,r){o[t.index]=r,n(e)})},function(t){r(t,o)})}else t(n,function(t,n){e(t.value,function(t){n(t)})})};i.map=h(v),i.mapSeries=m(v),i.mapLimit=function(t,n,e,r){return y(n)(t,e,r)};var y=function(t){return p(t,v)};i.reduce=function(t,n,e,r){i.eachSeries(t,function(t,r){e(n,t,function(t,e){n=e,r(t)})},function(t){r(t,n)})},i.inject=i.reduce,i.foldl=i.reduce,i.reduceRight=function(t,n,e,r){var o=a(t,function(t){return t}).reverse();i.reduce(o,n,e,r)},i.foldr=i.reduceRight;var g=function(t,n,e,r){var o=[];n=a(n,function(t,n){return{index:n,value:t}}),t(n,function(t,n){e(t.value,function(e){e&&o.push(t),n()})},function(){r(a(o.sort(function(t,n){return t.index-n.index}),function(t){return t.value}))})};i.filter=h(g),i.filterSeries=m(g),i.select=i.filter,i.selectSeries=i.filterSeries;var b=function(t,n,e,r){var o=[];n=a(n,function(t,n){return{index:n,value:t}}),t(n,function(t,n){e(t.value,function(e){e||o.push(t),n()})},function(){r(a(o.sort(function(t,n){return t.index-n.index}),function(t){return t.value}))})};i.reject=h(b),i.rejectSeries=m(b);var E=function(t,n,e,r){t(n,function(t,n){e(t,function(e){e?(r(t),r=function(){}):n()})},function(){r()})};i.detect=h(E),i.detectSeries=m(E),i.some=function(t,n,e){i.each(t,function(t,r){n(t,function(t){t&&(e(!0),e=function(){}),r()})},function(){e(!1)})},i.any=i.some,i.every=function(t,n,e){i.each(t,function(t,r){n(t,function(t){t||(e(!1),e=function(){}),r()})},function(){e(!0)})},i.all=i.every,i.sortBy=function(t,n,e){i.map(t,function(t,e){n(t,function(n,r){n?e(n):e(null,{value:t,criteria:r})})},function(t,n){if(t)return e(t);var r=function(t,n){var e=t.criteria,r=n.criteria;return r>e?-1:e>r?1:0};e(null,a(n.sort(r),function(t){return t.value}))})},i.auto=function(t,n){n=n||function(){};var e=f(t),r=e.length;if(!r)return n();var o={},u=[],a=function(t){u.unshift(t)},d=function(t){for(var n=0;n<u.length;n+=1)if(u[n]===t)return void u.splice(n,1)},h=function(){r--,s(u.slice(0),function(t){t()})};a(function(){if(!r){var t=n;n=function(){},t(null,o)}}),s(e,function(e){var r=c(t[e])?t[e]:[t[e]],u=function(t){var r=Array.prototype.slice.call(arguments,1);if(r.length<=1&&(r=r[0]),t){var u={};s(f(o),function(t){u[t]=o[t]}),u[e]=r,n(t,u),n=function(){}}else o[e]=r,i.setImmediate(h)},p=r.slice(0,Math.abs(r.length-1))||[],m=function(){return l(p,function(t,n){return t&&o.hasOwnProperty(n)},!0)&&!o.hasOwnProperty(e)};if(m())r[r.length-1](u,o);else{var v=function(){m()&&(d(v),r[r.length-1](u,o))};a(v)}})},i.retry=function(t,n,e){var r=5,o=[];"function"==typeof t&&(e=n,n=t,t=r),t=parseInt(t,10)||r;var u=function(r,u){for(var c=function(t,n){return function(e){t(function(t,r){e(!t||n,{err:t,result:r})},u)}};t;)o.push(c(n,!(t-=1)));i.series(o,function(t,n){n=n[n.length-1],(r||e)(n.err,n.result)})};return e?u():u},i.waterfall=function(t,n){if(n=n||function(){},!c(t)){var e=new Error("First argument to waterfall must be an array of functions");return n(e)}if(!t.length)return n();var r=function(t){return function(e){if(e)n.apply(null,arguments),n=function(){};else{var o=Array.prototype.slice.call(arguments,1),u=t.next();o.push(u?r(u):n),i.setImmediate(function(){t.apply(null,o)})}}};r(i.iterator(t))()};var S=function(t,n,e){if(e=e||function(){},c(n))t.map(n,function(t,n){t&&t(function(t){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),n.call(null,t,e)})},e);else{var r={};t.each(f(n),function(t,e){n[t](function(n){var o=Array.prototype.slice.call(arguments,1);o.length<=1&&(o=o[0]),r[t]=o,e(n)})},function(t){e(t,r)})}};i.parallel=function(t,n){S({map:i.map,each:i.each},t,n)},i.parallelLimit=function(t,n,e){S({map:y(n),each:d(n)},t,e)},i.series=function(t,n){if(n=n||function(){},c(t))i.mapSeries(t,function(t,n){t&&t(function(t){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),n.call(null,t,e)})},n);else{var e={};i.eachSeries(f(t),function(n,r){t[n](function(t){var o=Array.prototype.slice.call(arguments,1);o.length<=1&&(o=o[0]),e[n]=o,r(t)})},function(t){n(t,e)})}},i.iterator=function(t){var n=function(e){var r=function(){return t.length&&t[e].apply(null,arguments),r.next()};return r.next=function(){return e<t.length-1?n(e+1):null},r};return n(0)},i.apply=function(t){var n=Array.prototype.slice.call(arguments,1);return function(){return t.apply(null,n.concat(Array.prototype.slice.call(arguments)))}};var w=function(t,n,e,r){var o=[];t(n,function(t,n){e(t,function(t,e){o=o.concat(e||[]),n(t)})},function(t){r(t,o)})};i.concat=h(w),i.concatSeries=m(w),i.whilst=function(t,n,e){t()?n(function(r){return r?e(r):void i.whilst(t,n,e)}):e()},i.doWhilst=function(t,n,e){t(function(r){if(r)return e(r);var o=Array.prototype.slice.call(arguments,1);n.apply(null,o)?i.doWhilst(t,n,e):e()})},i.until=function(t,n,e){t()?e():n(function(r){return r?e(r):void i.until(t,n,e)})},i.doUntil=function(t,n,e){t(function(r){if(r)return e(r);var o=Array.prototype.slice.call(arguments,1);n.apply(null,o)?e():i.doUntil(t,n,e)})},i.queue=function(t,n){function r(t,n,e,r){return t.started||(t.started=!0),c(n)||(n=[n]),0==n.length?i.setImmediate(function(){t.drain&&t.drain()}):void s(n,function(n){var o={data:n,callback:"function"==typeof r?r:null};e?t.tasks.unshift(o):t.tasks.push(o),t.saturated&&t.tasks.length===t.concurrency&&t.saturated(),i.setImmediate(t.process)})}void 0===n&&(n=1);var o=0,u={tasks:[],concurrency:n,saturated:null,empty:null,drain:null,started:!1,paused:!1,push:function(t,n){r(u,t,!1,n)},kill:function(){u.drain=null,u.tasks=[]},unshift:function(t,n){r(u,t,!0,n)},process:function(){if(!u.paused&&o<u.concurrency&&u.tasks.length){var n=u.tasks.shift();u.empty&&0===u.tasks.length&&u.empty(),o+=1;var r=function(){o-=1,n.callback&&n.callback.apply(n,arguments),u.drain&&u.tasks.length+o===0&&u.drain(),u.process()},i=e(r);t(n.data,i)}},length:function(){return u.tasks.length},running:function(){return o},idle:function(){return u.tasks.length+o===0},pause:function(){u.paused!==!0&&(u.paused=!0,u.process())},resume:function(){u.paused!==!1&&(u.paused=!1,u.process())}};return u},i.cargo=function(t,n){var e=!1,r=[],o={tasks:r,payload:n,saturated:null,empty:null,drain:null,drained:!0,push:function(t,e){c(t)||(t=[t]),s(t,function(t){r.push({data:t,callback:"function"==typeof e?e:null}),o.drained=!1,o.saturated&&r.length===n&&o.saturated()}),i.setImmediate(o.process)},process:function u(){if(!e){if(0===r.length)return o.drain&&!o.drained&&o.drain(),void(o.drained=!0);var i="number"==typeof n?r.splice(0,n):r.splice(0,r.length),c=a(i,function(t){return t.data});o.empty&&o.empty(),e=!0,t(c,function(){e=!1;var t=arguments;s(i,function(n){n.callback&&n.callback.apply(null,t)}),u()})}},length:function(){return r.length},running:function(){return e}};return o};var _=function(t){return function(n){var e=Array.prototype.slice.call(arguments,1);n.apply(null,e.concat([function(n){var e=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(n?console.error&&console.error(n):console[t]&&s(e,function(n){console[t](n)}))}]))}};i.log=_("log"),i.dir=_("dir"),i.memoize=function(t,n){var e={},r={};n=n||function(t){return t};var o=function(){var o=Array.prototype.slice.call(arguments),u=o.pop(),c=n.apply(null,o);c in e?i.nextTick(function(){u.apply(null,e[c])}):c in r?r[c].push(u):(r[c]=[u],t.apply(null,o.concat([function(){e[c]=arguments;var t=r[c];delete r[c];for(var n=0,o=t.length;o>n;n++)t[n].apply(null,arguments)}])))};return o.memo=e,o.unmemoized=t,o},i.unmemoize=function(t){return function(){return(t.unmemoized||t).apply(null,arguments)}},i.times=function(t,n,e){for(var r=[],o=0;t>o;o++)r.push(o);return i.map(r,n,e)},i.timesSeries=function(t,n,e){for(var r=[],o=0;t>o;o++)r.push(o);return i.mapSeries(r,n,e)},i.seq=function(){var t=arguments;return function(){var n=this,e=Array.prototype.slice.call(arguments),r=e.pop();i.reduce(t,e,function(t,e,r){e.apply(n,t.concat([function(){var t=arguments[0],n=Array.prototype.slice.call(arguments,1);r(t,n)}]))},function(t,e){r.apply(n,[t].concat(e))})}},i.compose=function(){return i.seq.apply(null,Array.prototype.reverse.call(arguments))};var x=function(t,n){var e=function(){var e=this,r=Array.prototype.slice.call(arguments),o=r.pop();return t(n,function(t,n){t.apply(e,r.concat([n]))},o)};if(arguments.length>2){var r=Array.prototype.slice.call(arguments,2);return e.apply(this,r)}return e};i.applyEach=h(x),i.applyEachSeries=m(x),i.forever=function(t,n){function e(r){if(r){if(n)return n(r);throw r}t(e)}e()},"undefined"!=typeof n&&n.exports?n.exports=i:"undefined"!=typeof define&&define.amd?define([],function(){return i}):r.async=i}()}).call(this,t("/home/clayton/dev/mWater/minimongo/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"/home/clayton/dev/mWater/minimongo/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":18}],17:[function(t,n){!function(t,e){"undefined"!=typeof n&&n.exports?n.exports.browser=e():"function"==typeof define?define(e):this[t]=e()}("bowser",function(){function t(t){function e(n){var e=t.match(n);return e&&e.length>1&&e[1]||""}var r,o=e(/(ipod|iphone|ipad)/i).toLowerCase(),i=/like android/i.test(t),u=!i&&/android/i.test(t),c=e(/version\/(\d+(\.\d+)?)/i),s=/tablet/i.test(t),a=!s&&/[^-]mobi/i.test(t);/opera|opr/i.test(t)?r={name:"Opera",opera:n,version:c||e(/(?:opera|opr)[\s\/](\d+(\.\d+)?)/i)}:/windows phone/i.test(t)?r={name:"Windows Phone",windowsphone:n,msie:n,version:e(/iemobile\/(\d+(\.\d+)?)/i)}:/msie|trident/i.test(t)?r={name:"Internet Explorer",msie:n,version:e(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:/chrome|crios|crmo/i.test(t)?r={name:"Chrome",chrome:n,version:e(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:o?(r={name:"iphone"==o?"iPhone":"ipad"==o?"iPad":"iPod"},c&&(r.version=c)):/sailfish/i.test(t)?r={name:"Sailfish",sailfish:n,version:e(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(t)?r={name:"SeaMonkey",seamonkey:n,version:e(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel/i.test(t)?(r={name:"Firefox",firefox:n,version:e(/(?:firefox|iceweasel)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(t)&&(r.firefoxos=n)):/silk/i.test(t)?r={name:"Amazon Silk",silk:n,version:e(/silk\/(\d+(\.\d+)?)/i)}:u?r={name:"Android",version:c}:/phantom/i.test(t)?r={name:"PhantomJS",phantom:n,version:e(/phantomjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(t)||/rim\stablet/i.test(t)?r={name:"BlackBerry",blackberry:n,version:c||e(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:/(web|hpw)os/i.test(t)?(r={name:"WebOS",webos:n,version:c||e(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(t)&&(r.touchpad=n)):r=/bada/i.test(t)?{name:"Bada",bada:n,version:e(/dolfin\/(\d+(\.\d+)?)/i)}:/tizen/i.test(t)?{name:"Tizen",tizen:n,version:e(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||c}:/safari/i.test(t)?{name:"Safari",safari:n,version:c}:{},/(apple)?webkit/i.test(t)?(r.name=r.name||"Webkit",r.webkit=n,!r.version&&c&&(r.version=c)):!r.opera&&/gecko\//i.test(t)&&(r.name=r.name||"Gecko",r.gecko=n,r.version=r.version||e(/gecko\/(\d+(\.\d+)?)/i)),u||r.silk?r.android=n:o&&(r[o]=n,r.ios=n);var l="";o?(l=e(/os (\d+([_\s]\d+)*) like mac os x/i),l=l.replace(/[_\s]/g,".")):u?l=e(/android[ \/-](\d+(\.\d+)*)/i):r.windowsphone?l=e(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):r.webos?l=e(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):r.blackberry?l=e(/rim\stablet\sos\s(\d+(\.\d+)*)/i):r.bada?l=e(/bada\/(\d+(\.\d+)*)/i):r.tizen&&(l=e(/tizen[\/\s](\d+(\.\d+)*)/i)),l&&(r.osversion=l);var f=l.split(".")[0];return s||"ipad"==o||u&&(3==f||4==f&&!a)||r.silk?r.tablet=n:(a||"iphone"==o||"ipod"==o||u||r.blackberry||r.webos||r.bada)&&(r.mobile=n),r.msie&&r.version>=10||r.chrome&&r.version>=20||r.firefox&&r.version>=20||r.safari&&r.version>=6||r.opera&&r.version>=10||r.ios&&r.osversion&&r.osversion.split(".")[0]>=6?r.a=n:r.msie&&r.version<10||r.chrome&&r.version<20||r.firefox&&r.version<20||r.safari&&r.version<6||r.opera&&r.version<10||r.ios&&r.osversion&&r.osversion.split(".")[0]<6?r.c=n:r.x=n,r}var n=!0,e=t("undefined"!=typeof navigator?navigator.userAgent:"");return e._detect=t,e})},{}],18:[function(t,n){var e=n.exports={};e.nextTick=function(){var t="undefined"!=typeof window&&window.setImmediate,n="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(t)return function(t){return window.setImmediate(t)};if(n){var e=[];return window.addEventListener("message",function(t){var n=t.source;if((n===window||null===n)&&"process-tick"===t.data&&(t.stopPropagation(),e.length>0)){var r=e.shift();r()}},!0),function(t){e.push(t),window.postMessage("process-tick","*")}}return function(t){setTimeout(t,0)}}(),e.title="browser",e.browser=!0,e.env={},e.argv=[],e.binding=function(){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(){throw new Error("process.chdir is not supported")}},{}],19:[function(t,n){!function(t,e,r){"function"==typeof define?define(e):"undefined"!=typeof n&&n.exports?n.exports=e():r[t]=e()}("IDBStore",function(){"use strict";var t=function(t){throw t},n={storeName:"Store",storePrefix:"IDBWrapper-",dbVersion:1,keyPath:"id",autoIncrement:!0,onStoreReady:function(){},onError:t,indexes:[]},e=function(t,e){"undefined"==typeof e&&"function"==typeof t&&(e=t),"[object Object]"!=Object.prototype.toString.call(t)&&(t={});for(var r in n)this[r]="undefined"!=typeof t[r]?t[r]:n[r];this.dbName=this.storePrefix+this.storeName,this.dbVersion=parseInt(this.dbVersion,10)||1,e&&(this.onStoreReady=e);var o="object"==typeof window?window:self;this.idb=o.indexedDB||o.webkitIndexedDB||o.mozIndexedDB,this.keyRange=o.IDBKeyRange||o.webkitIDBKeyRange||o.mozIDBKeyRange,this.features={hasAutoIncrement:!o.mozIndexedDB},this.consts={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange",NEXT:"next",NEXT_NO_DUPLICATE:"nextunique",PREV:"prev",PREV_NO_DUPLICATE:"prevunique"},this.openDB()};e.prototype={constructor:e,version:"1.4.1",db:null,dbName:null,dbVersion:null,store:null,storeName:null,keyPath:null,autoIncrement:null,indexes:null,features:null,onStoreReady:null,onError:null,_insertIdCount:0,openDB:function(){var t=this.idb.open(this.dbName,this.dbVersion),n=!1;t.onerror=function(t){var n=!1;"error"in t.target?n="VersionError"==t.target.error.name:"errorCode"in t.target&&(n=12==t.target.errorCode),this.onError(n?new Error("The version number provided is lower than the existing one."):t)}.bind(this),t.onsuccess=function(t){if(!n){if(this.db)return void this.onStoreReady();if(this.db=t.target.result,"string"==typeof this.db.version)return void this.onError(new Error("The IndexedDB implementation in this browser is outdated. Please upgrade your browser."));if(!this.db.objectStoreNames.contains(this.storeName))return void this.onError(new Error("Something is wrong with the IndexedDB implementation in this browser. Please upgrade your browser."));var e=this.db.transaction([this.storeName],this.consts.READ_ONLY);this.store=e.objectStore(this.storeName);var r=Array.prototype.slice.call(this.getIndexList());this.indexes.forEach(function(t){var e=t.name;if(!e)return n=!0,void this.onError(new Error("Cannot create index: No index name given."));if(this.normalizeIndexData(t),this.hasIndex(e)){var o=this.store.index(e),i=this.indexComplies(o,t);i||(n=!0,this.onError(new Error('Cannot modify index "'+e+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))),r.splice(r.indexOf(e),1)}else n=!0,this.onError(new Error('Cannot create new index "'+e+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))},this),r.length&&(n=!0,this.onError(new Error('Cannot delete index(es) "'+r.toString()+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))),n||this.onStoreReady()}}.bind(this),t.onupgradeneeded=function(t){if(this.db=t.target.result,this.db.objectStoreNames.contains(this.storeName))this.store=t.target.transaction.objectStore(this.storeName);else{var e={autoIncrement:this.autoIncrement};null!==this.keyPath&&(e.keyPath=this.keyPath),this.store=this.db.createObjectStore(this.storeName,e)}var r=Array.prototype.slice.call(this.getIndexList());this.indexes.forEach(function(t){var e=t.name;if(e||(n=!0,this.onError(new Error("Cannot create index: No index name given."))),this.normalizeIndexData(t),this.hasIndex(e)){var o=this.store.index(e),i=this.indexComplies(o,t);i||(this.store.deleteIndex(e),this.store.createIndex(e,t.keyPath,{unique:t.unique,multiEntry:t.multiEntry})),r.splice(r.indexOf(e),1)}else this.store.createIndex(e,t.keyPath,{unique:t.unique,multiEntry:t.multiEntry})},this),r.length&&r.forEach(function(t){this.store.deleteIndex(t)},this)}.bind(this)},deleteDatabase:function(){this.idb.deleteDatabase&&this.idb.deleteDatabase(this.dbName)},put:function(n,e,o,i){null!==this.keyPath&&(i=o,o=e,e=n),i||(i=t),o||(o=r);var u,c=!1,s=null,a=this.db.transaction([this.storeName],this.consts.READ_WRITE);return a.oncomplete=function(){var t=c?o:i;t(s)},a.onabort=i,a.onerror=i,null!==this.keyPath?(this._addIdPropertyIfNeeded(e),u=a.objectStore(this.storeName).put(e)):u=a.objectStore(this.storeName).put(e,n),u.onsuccess=function(t){c=!0,s=t.target.result},u.onerror=i,a},get:function(n,e,o){o||(o=t),e||(e=r);var i=!1,u=null,c=this.db.transaction([this.storeName],this.consts.READ_ONLY);c.oncomplete=function(){var t=i?e:o;t(u)},c.onabort=o,c.onerror=o;var s=c.objectStore(this.storeName).get(n);return s.onsuccess=function(t){i=!0,u=t.target.result},s.onerror=o,c},remove:function(n,e,o){o||(o=t),e||(e=r);var i=!1,u=null,c=this.db.transaction([this.storeName],this.consts.READ_WRITE);c.oncomplete=function(){var t=i?e:o;t(u)},c.onabort=o,c.onerror=o;var s=c.objectStore(this.storeName)["delete"](n);return s.onsuccess=function(t){i=!0,u=t.target.result},s.onerror=o,c},batch:function(n,e,o){o||(o=t),e||(e=r),"[object Array]"!=Object.prototype.toString.call(n)&&o(new Error("dataArray argument must be of type Array."));var i=this.db.transaction([this.storeName],this.consts.READ_WRITE);i.oncomplete=function(){var t=s?e:o;t(s)},i.onabort=o,i.onerror=o;var u=n.length,c=!1,s=!1,a=function(){u--,0!==u||c||(c=!0,s=!0)};return n.forEach(function(t){var n=t.type,e=t.key,r=t.value,u=function(t){i.abort(),c||(c=!0,o(t,n,e))};if("remove"==n){var s=i.objectStore(this.storeName)["delete"](e);s.onsuccess=a,s.onerror=u}else if("put"==n){var l;null!==this.keyPath?(this._addIdPropertyIfNeeded(r),l=i.objectStore(this.storeName).put(r)):l=i.objectStore(this.storeName).put(r,e),l.onsuccess=a,l.onerror=u}},this),i},putBatch:function(t,n,e){var r=t.map(function(t){return{type:"put",value:t}});return this.batch(r,n,e)},removeBatch:function(t,n,e){var r=t.map(function(t){return{type:"remove",key:t}});return this.batch(r,n,e)},getBatch:function(n,e,o,i){o||(o=t),e||(e=r),i||(i="sparse"),"[object Array]"!=Object.prototype.toString.call(n)&&o(new Error("keyArray argument must be of type Array."));var u=this.db.transaction([this.storeName],this.consts.READ_ONLY);u.oncomplete=function(){var t=l?e:o;t(f)},u.onabort=o,u.onerror=o;var c=[],s=n.length,a=!1,l=!1,f=null,d=function(t){t.target.result||"dense"==i?c.push(t.target.result):"sparse"==i&&c.length++,s--,0===s&&(a=!0,l=!0,f=c)};return n.forEach(function(t){var n=function(t){a=!0,f=t,o(t),u.abort()},e=u.objectStore(this.storeName).get(t);e.onsuccess=d,e.onerror=n},this),u},getAll:function(n,e){e||(e=t),n||(n=r);var o=this.db.transaction([this.storeName],this.consts.READ_ONLY),i=o.objectStore(this.storeName);return i.getAll?this._getAllNative(o,i,n,e):this._getAllCursor(o,i,n,e),o},_getAllNative:function(t,n,e,r){var o=!1,i=null;t.oncomplete=function(){var t=o?e:r;t(i)},t.onabort=r,t.onerror=r;var u=n.getAll();u.onsuccess=function(t){o=!0,i=t.target.result},u.onerror=r},_getAllCursor:function(t,n,e,r){var o=[],i=!1,u=null;t.oncomplete=function(){var t=i?e:r;t(u)},t.onabort=r,t.onerror=r;var c=n.openCursor();c.onsuccess=function(t){var n=t.target.result;n?(o.push(n.value),n["continue"]()):(i=!0,u=o)},c.onError=r},clear:function(n,e){e||(e=t),n||(n=r);var o=!1,i=null,u=this.db.transaction([this.storeName],this.consts.READ_WRITE);u.oncomplete=function(){var t=o?n:e;t(i)},u.onabort=e,u.onerror=e;var c=u.objectStore(this.storeName).clear();return c.onsuccess=function(t){o=!0,i=t.target.result},c.onerror=e,u},_addIdPropertyIfNeeded:function(t){this.features.hasAutoIncrement||"undefined"!=typeof t[this.keyPath]||(t[this.keyPath]=this._insertIdCount++ +Date.now())},getIndexList:function(){return this.store.indexNames},hasIndex:function(t){return this.store.indexNames.contains(t)},normalizeIndexData:function(t){t.keyPath=t.keyPath||t.name,t.unique=!!t.unique,t.multiEntry=!!t.multiEntry},indexComplies:function(t,n){var e=["keyPath","unique","multiEntry"].every(function(e){if("multiEntry"==e&&void 0===t[e]&&n[e]===!1)return!0;
if("keyPath"==e&&"[object Array]"==Object.prototype.toString.call(n[e])){var r=n.keyPath,o=t.keyPath;if("string"==typeof o)return r.toString()==o;if("function"!=typeof o.contains&&"function"!=typeof o.indexOf)return!1;if(o.length!==r.length)return!1;for(var i=0,u=r.length;u>i;i++)if(!(o.contains&&o.contains(r[i])||o.indexOf(-1!==r[i])))return!1;return!0}return n[e]==t[e]});return e},iterate:function(n,e){e=i({index:null,order:"ASC",autoContinue:!0,filterDuplicates:!1,keyRange:null,writeAccess:!1,onEnd:null,onError:t},e||{});var r="desc"==e.order.toLowerCase()?"PREV":"NEXT";e.filterDuplicates&&(r+="_NO_DUPLICATE");var o=!1,u=this.db.transaction([this.storeName],this.consts[e.writeAccess?"READ_WRITE":"READ_ONLY"]),c=u.objectStore(this.storeName);e.index&&(c=c.index(e.index)),u.oncomplete=function(){return o?void(e.onEnd?e.onEnd():n(null)):void e.onError(null)},u.onabort=e.onError,u.onerror=e.onError;var s=c.openCursor(e.keyRange,this.consts[r]);return s.onerror=e.onError,s.onsuccess=function(t){var r=t.target.result;r?(n(r.value,r,u),e.autoContinue&&r["continue"]()):o=!0},u},query:function(t,n){var e=[];return n=n||{},n.onEnd=function(){t(e)},this.iterate(function(t){e.push(t)},n)},count:function(n,e){e=i({index:null,keyRange:null},e||{});var r=e.onError||t,o=!1,u=null,c=this.db.transaction([this.storeName],this.consts.READ_ONLY);c.oncomplete=function(){var t=o?n:r;t(u)},c.onabort=r,c.onerror=r;var s=c.objectStore(this.storeName);e.index&&(s=s.index(e.index));var a=s.count(e.keyRange);return a.onsuccess=function(t){o=!0,u=t.target.result},a.onError=r,c},makeKeyRange:function(t){var n,e="undefined"!=typeof t.lower,r="undefined"!=typeof t.upper,o="undefined"!=typeof t.only;switch(!0){case o:n=this.keyRange.only(t.only);break;case e&&r:n=this.keyRange.bound(t.lower,t.upper,t.excludeLower,t.excludeUpper);break;case e:n=this.keyRange.lowerBound(t.lower,t.excludeLower);break;case r:n=this.keyRange.upperBound(t.upper,t.excludeUpper);break;default:throw new Error('Cannot create KeyRange. Provide one or both of "lower" or "upper" value, or an "only" value.')}return n}};var r=function(){},o={},i=function(t,n){var e,r;for(e in n)r=n[e],r!==o[e]&&r!==t[e]&&(t[e]=r);return t};return e.version=e.prototype.version,e},this)},{}]},{},[]);